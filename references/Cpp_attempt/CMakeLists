cmake_minimum_required(VERSION 3.15)
project(zeroconfai_proxy CXX)

# C++17 is required (for std::optional, structured bindings, etc.)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Find required packages
find_package(CURL REQUIRED)
find_package(Threads REQUIRED)

# cpp-httplib and nlohmann-json are header-only libraries
# They should be in your include path or installed via package manager
# On Ubuntu: sudo apt-get install libcurl4-openssl-dev
# On macOS: brew install curl

# Source files
set(SOURCES
    main.cpp
    local_proxy_client.cpp
)

# Create executable
add_executable(zeroconfai_proxy ${SOURCES})

# Link libraries
target_link_libraries(zeroconfai_proxy
    PRIVATE
    CURL::libcurl
    Threads::Threads
)

# Include directories for header-only libraries
# Adjust these paths based on where you install cpp-httplib and nlohmann-json
target_include_directories(zeroconfai_proxy
    PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    # Add paths to cpp-httplib and nlohmann-json if not in system path
    # e.g., /usr/local/include or ${CMAKE_SOURCE_DIR}/third_party
)

# Compiler warnings
if(CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    target_compile_options(zeroconfai_proxy PRIVATE
        -Wall -Wextra -Wpedantic
    )
endif()

# Installation
install(TARGETS zeroconfai_proxy
    RUNTIME DESTINATION bin
)

# Print configuration
message(STATUS "C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "Build Type: ${CMAKE_BUILD_TYPE}")