PyInstaller Integration Concept for VLC ZeroConf Extension

PROBLEM STATEMENT
=================
Currently: Two separate components that must be installed and run independently
- vlc_discovery_bridge.py (Python service)
- zeroconf_ai_chat.lua (VLC extension)

This violates "zero configuration" because:
- User must have Python installed
- User must install dependencies (fastapi, uvicorn, zeroconf, requests)
- User must manually run the Python bridge before using VLC extension
- Different setup steps for Windows/Mac/Linux


THE PYINSTALLER SOLUTION
=========================
Package the Python bridge as a standalone executable that Lua can launch.

Key insight: Lua has proved that io.popen() works reliably.
We just need Lua to launch a binary instead of Python source code.


WHAT WE KNOW TO BE TRUE
=======================

1. io.popen() works reliably in VLC Lua
   - Your vlc_hello_minimal.lua proves this
   - It's the ONLY reliable execution method in VLC's sandbox
   - It can launch executables just as easily as Python

2. PyInstaller can bundle Python + all dependencies into one executable
   - Creates self-contained binary
   - No Python installation needed on target machine
   - Can bundle FastAPI, uvicorn, zeroconf, requests, everything
   - Works cross-platform (Windows .exe, Mac app, Linux binary)

3. The bridge needs to communicate its port back to Lua
   - Bridge already has --port-file argument
   - It writes "host:port" to a text file
   - Lua can read this file to know where to connect

4. VLC extensions can bundle data files
   - Extensions are just directories
   - We can include the compiled executable in the extension folder
   - Lua can reference files relative to its own location


THE INTEGRATION ARCHITECTURE
============================

File Structure After PyInstaller:
vlc_extensions/
  zeroconf_ai_chat/
    main.lua                          (your extension)
    bridge/
      vlc_discovery_bridge.exe        (Windows)
      vlc_discovery_bridge            (Linux/Mac)
    README.txt

How It Works:
1. User installs the VLC extension (drag folder to VLC extensions directory)
2. User activates extension in VLC
3. Lua's activate() function:
   - Detects OS (Windows/Linux/Mac)
   - Builds path to bundled executable
   - Launches bridge using io.popen()
   - Reads port file to discover where bridge is running
   - Makes HTTP requests to bridge as needed
4. When extension deactivates:
   - Sends shutdown request to bridge
   - Bridge exits cleanly


WHAT NEEDS TO BE IMPLEMENTED
============================

Bridge Modifications (vlc_discovery_bridge.py):
- Already has --port-file argument ✓
- Already has auto-port-detection ✓
- Needs a /shutdown endpoint so Lua can cleanly stop it
- That's it. Everything else already works.

Lua Modifications (zeroconf_ai_chat.lua):
- On activate():
  * Detect OS to choose correct binary name
  * Build path to bundled executable
  * Create temp directory for port file
  * Launch bridge with io.popen("path/to/bridge --port-file /tmp/vlc_bridge_port.txt")
  * Wait briefly for startup
  * Read port file to get "127.0.0.1:9876" (or whatever port)
  * Store bridge URL for later use
  * Make HTTP requests to bridge as normal

- On deactivate():
  * Send HTTP request to bridge's /shutdown endpoint
  * Clean up port file
  * Done

PyInstaller Build Process:
- Create spec file for vlc_discovery_bridge.py
- Include all dependencies (fastapi, uvicorn, zeroconf, etc.)
- Build for each platform (Windows, Mac, Linux)
- Result: standalone executables that bundle everything


COMPARISON TO CURRENT APPROACH
==============================

Current (broken):
User installs extension
User separately installs Python
User separately installs pip packages
User separately runs python script
User opens VLC and tries extension
Hope everything connects

PyInstaller approach:
User installs extension
User opens VLC and uses extension
Done.


KNOWN TRUTHS THAT MAKE THIS WORK
=================================

1. io.popen() can launch executables (proven by your minimal script)
2. PyInstaller creates executables (this is its entire purpose)
3. VLC extensions are directories (can contain executables)
4. The bridge writes its port to a file (already implemented)
5. Lua can read files (io.open works)
6. HTTP works from Lua (your current extension already does this)

Therefore: All required primitives exist and work.
We just need to connect them.


THE ACTUAL WORK REQUIRED
=========================

1. Add /shutdown endpoint to bridge
   - Simple 5-line addition
   - Makes bridge exit cleanly when called

2. Modify Lua to launch bundled executable instead of assuming bridge runs separately
   - Replace hardcoded "http://localhost:9876" with dynamic port reading
   - Add bridge launch logic to activate()
   - Add bridge shutdown logic to deactivate()

3. Create PyInstaller build script
   - Write .spec file
   - Run pyinstaller on each platform
   - Test resulting executables

4. Package everything as single VLC extension
   - Directory structure with Lua + executables
   - One-step installation


WHY THIS IS BETTER THAN FIGHTING LUA SANDBOX
============================================

Lua sandbox problems:
- os.execute() unreliable
- os.tmpname() broken
- Background processes don't work
- IPC is race-prone
- No error messages when things fail

PyInstaller solution avoids ALL of these:
- Uses only io.popen() (the one thing that works)
- Bridge is a real compiled executable (not a Python script)
- No temp file creation in Lua (bridge handles its own files)
- No background process tricks (just launch and read port file)
- Clear error handling (bridge logs to stdout, Lua can read it)


NEXT STEPS
==========

If you choose this path:

1. Add shutdown endpoint to bridge (trivial)
2. Build bridge with PyInstaller for your OS
3. Test that Lua can launch it and read port file
4. Once proven on one platform, expand to others
5. Package as complete extension

This is less work than continuing to fight the Lua sandbox,
and results in actual zero-configuration deployment.


FINAL THOUGHT
=============

You've already done the hard work:
- Built a working discovery bridge
- Proven io.popen() works in VLC
- Documented why other approaches fail

Don't keep fighting a hostile environment.
Use the tool designed for exactly this problem: PyInstaller.